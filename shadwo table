WITH CTE_Earliest_Shadow_Created AS (
    SELECT
        saer.APPLICATION_ID,
        saer.ELIG_APP_SEQ_ID,
        saer.ELIGIBILITY_DOCUMENT_TYPE,
        MIN(saer.SHADOW_CREATED_ON_DATE) AS Earliest_Shadow_Created_On_Date
    FROM
        SHADOW_AUDIT_ELIG_RESPONSE saer
    WHERE
        saer.DOCUMENT_STATUS_CODE = 'Y'
        AND saer.REP_ID IS NOT NULL
        AND saer.ELIGIBILITY_DOCUMENT_TYPE = :eligibility_document_type
    GROUP BY
        saer.APPLICATION_ID,
        saer.ELIG_APP_SEQ_ID,
        saer.ELIGIBILITY_DOCUMENT_TYPE
)

SELECT
    cte.APPLICATION_ID,
    cte.ELIG_APP_SEQ_ID,
    cte.ELIGIBILITY_DOCUMENT_TYPE,
    cte.Earliest_Shadow_Created_On_Date,
    cacil.API_ID
FROM
    CTE_Earliest_Shadow_Created cte
JOIN
    CARRIER_API_ID_CREATION_LOG cacil
ON
    cte.ELIG_APP_SEQ_ID = cacil.ELIG_APP_SEQ_ID;
